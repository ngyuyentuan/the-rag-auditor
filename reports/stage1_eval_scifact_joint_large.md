# Stage1 Large-N Eval (scifact)

- in_path: `/mnt/c/Users/nguye/Downloads/My projject/the-rag-auditor/data/calibration/scifact_stage1_dev_train.parquet`
- n_total: 776
- seed: 14
- logit_col: `raw_max_top3`
- y_col: `y`

## Baseline config
- thresholds_yaml: `configs/thresholds.yaml`
- t_lower: 0.7792245061204353
- t_upper: 0.8008901176300922
- tau: 0.609483051351548

| metric | value | 95% CI |
|---|---:|---:|
| accept_rate | 0.4536 | [0.4188, 0.4871] |
| reject_rate | 0.0619 | [0.0464, 0.0799] |
| uncertain_rate | 0.4845 | [0.4510, 0.5193] |
| fp_accept_rate | 0.0425 | [0.0296, 0.0567] |
| fn_reject_rate | 0.0322 | [0.0206, 0.0464] |
| risk | 0.0747 | |
| coverage | 0.5155 | [0.4807, 0.5490] |
| ok_rate | 0.9253 | [0.9053, 0.9427] |
| precision_accept | 0.9062 | |

## Tuned config
- tuned_thresholds_yaml: `configs/thresholds_stage1_joint_tuned_scifact.yaml`
- t_lower: 0.7879591836734694
- t_upper: 0.8181632653061224
- tau: 0.5661016949152542

| metric | value | 95% CI |
|---|---:|---:|
| accept_rate | 0.4278 | [0.3918, 0.4646] |
| reject_rate | 0.0258 | [0.0155, 0.0380] |
| uncertain_rate | 0.5464 | [0.5083, 0.5825] |
| fp_accept_rate | 0.0374 | [0.0245, 0.0509] |
| fn_reject_rate | 0.0103 | [0.0039, 0.0180] |
| risk | 0.0477 | |
| coverage | 0.4536 | [0.4175, 0.4917] |
| ok_rate | 0.9523 | [0.9369, 0.9665] |
| precision_accept | 0.9127 | |

## McNemar exact test
- b (A correct, B wrong): 0
- c (A wrong, B correct): 21
- p_value: 0.000001

## Bootstrap delta CI (tuned - baseline)
| metric | 95% CI |
|---|---:|
| ok_rate | [0.0168, 0.0387] |
| fp_accept_rate | [-0.0103, -0.0013] |
| fn_reject_rate | [-0.0322, -0.0129] |
| uncertain_rate | [0.0444, 0.0799] |

## Risk-coverage sweep
### Top coverage under risk <= 0.02
| t_lower | t_upper | risk | coverage |
|---:|---:|---:|---:|
| 0.0000 | 0.8350 | 0.0000 | 0.0000 |
| 0.0000 | 0.8763 | 0.0000 | 0.0000 |
| 0.0000 | 0.9175 | 0.0000 | 0.0000 |
| 0.0000 | 0.9588 | 0.0000 | 0.0000 |
| 0.0000 | 1.0000 | 0.0000 | 0.0000 |
| 0.0413 | 0.8350 | 0.0000 | 0.0000 |
| 0.0413 | 0.8763 | 0.0000 | 0.0000 |
| 0.0413 | 0.9175 | 0.0000 | 0.0000 |
| 0.0413 | 0.9588 | 0.0000 | 0.0000 |
| 0.0413 | 1.0000 | 0.0000 | 0.0000 |
| 0.0825 | 0.8350 | 0.0000 | 0.0000 |
| 0.0825 | 0.8763 | 0.0000 | 0.0000 |
| 0.0825 | 0.9175 | 0.0000 | 0.0000 |
| 0.0825 | 0.9588 | 0.0000 | 0.0000 |
| 0.0825 | 1.0000 | 0.0000 | 0.0000 |
| 0.1237 | 0.8350 | 0.0000 | 0.0000 |
| 0.1237 | 0.8763 | 0.0000 | 0.0000 |
| 0.1237 | 0.9175 | 0.0000 | 0.0000 |
| 0.1237 | 0.9588 | 0.0000 | 0.0000 |
| 0.1237 | 1.0000 | 0.0000 | 0.0000 |

### Top coverage under risk <= 0.05
| t_lower | t_upper | risk | coverage |
|---:|---:|---:|---:|
| 0.0000 | 0.8350 | 0.0000 | 0.0000 |
| 0.0000 | 0.8763 | 0.0000 | 0.0000 |
| 0.0000 | 0.9175 | 0.0000 | 0.0000 |
| 0.0000 | 0.9588 | 0.0000 | 0.0000 |
| 0.0000 | 1.0000 | 0.0000 | 0.0000 |
| 0.0413 | 0.8350 | 0.0000 | 0.0000 |
| 0.0413 | 0.8763 | 0.0000 | 0.0000 |
| 0.0413 | 0.9175 | 0.0000 | 0.0000 |
| 0.0413 | 0.9588 | 0.0000 | 0.0000 |
| 0.0413 | 1.0000 | 0.0000 | 0.0000 |
| 0.0825 | 0.8350 | 0.0000 | 0.0000 |
| 0.0825 | 0.8763 | 0.0000 | 0.0000 |
| 0.0825 | 0.9175 | 0.0000 | 0.0000 |
| 0.0825 | 0.9588 | 0.0000 | 0.0000 |
| 0.0825 | 1.0000 | 0.0000 | 0.0000 |
| 0.1237 | 0.8350 | 0.0000 | 0.0000 |
| 0.1237 | 0.8763 | 0.0000 | 0.0000 |
| 0.1237 | 0.9175 | 0.0000 | 0.0000 |
| 0.1237 | 0.9588 | 0.0000 | 0.0000 |
| 0.1237 | 1.0000 | 0.0000 | 0.0000 |

### Top coverage under risk <= 0.1
| t_lower | t_upper | risk | coverage |
|---:|---:|---:|---:|
| 0.0000 | 0.7938 | 0.0902 | 0.6765 |
| 0.0413 | 0.7938 | 0.0902 | 0.6765 |
| 0.0825 | 0.7938 | 0.0902 | 0.6765 |
| 0.1237 | 0.7938 | 0.0902 | 0.6765 |
| 0.1650 | 0.7938 | 0.0902 | 0.6765 |
| 0.2063 | 0.7938 | 0.0902 | 0.6765 |
| 0.2475 | 0.7938 | 0.0902 | 0.6765 |
| 0.2888 | 0.7938 | 0.0902 | 0.6765 |
| 0.3300 | 0.7938 | 0.0902 | 0.6765 |
| 0.3713 | 0.7938 | 0.0902 | 0.6765 |
| 0.4125 | 0.7938 | 0.0902 | 0.6765 |
| 0.4538 | 0.7938 | 0.0902 | 0.6765 |
| 0.4950 | 0.7938 | 0.0902 | 0.6765 |
| 0.5363 | 0.7938 | 0.0902 | 0.6765 |
| 0.5775 | 0.7938 | 0.0902 | 0.6765 |
| 0.6188 | 0.7938 | 0.0902 | 0.6765 |
| 0.6600 | 0.7938 | 0.0902 | 0.6765 |
| 0.7013 | 0.7938 | 0.0902 | 0.6765 |
| 0.7425 | 0.7938 | 0.0902 | 0.6765 |
| 0.7838 | 0.8350 | 0.0657 | 0.1173 |


## Repro command
```
scripts/eval_stage1_large_n.py --track scifact --in_path /mnt/c/Users/nguye/Downloads/My projject/the-rag-auditor/data/calibration/scifact_stage1_dev_train.parquet --logit_col raw_max_top3 --y_col y --tuned_thresholds_yaml configs/thresholds_stage1_joint_tuned_scifact.yaml --n 1000 --out_md reports/stage1_eval_scifact_joint_large.md
```
