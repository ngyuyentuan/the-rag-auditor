# Stage1 Utility Tuning (scifact)

Config

- in_path: `/mnt/c/Users/nguye/Downloads/My projject/the-rag-auditor/data/calibration/scifact_stage1_dev_train.parquet`
- n_raw: `776`
- n_used: `776`
- seed: `14`
- logit_col: `raw_max_top3`
- y_col: `y`
- tau_source: `joint_grid`
- tau_grid_min: `0.2`
- tau_grid_max: `2.0`
- tau_grid_steps: `60`
- max_fp_accept_rate: `0.05`
- max_fn_reject_rate: `0.05`
- max_fp_decided_upper95: `0.1`
- max_fn_decided_upper95: `0.1`
- lambda_fp: `10.0`
- lambda_fn: `10.0`
- lambda_unc: `1.0`
- constraint_ci: `wilson`
- min_coverage: `0.0`
- constraint_scope: `both`
- enforce_decided_ci: `False`

Baseline thresholds

- tau: `0.609483051351548`
- t_lower: `0.7792245061204353`
- t_upper: `0.8008901176300922`

| metric | value |
|---|---|
| accept_rate | 0.4536 |
| reject_rate | 0.0619 |
| uncertain_rate | 0.4845 |
| fp_accept_rate | 0.0425 |
| fn_reject_rate | 0.0322 |
| ok_rate | 0.9253 |
| coverage | 0.5155 |
| accuracy_on_decided | 0.8550 |

- feasible_configs: `38326`

Top configs by utility

| tau | t_lower | t_upper | accept_rate | reject_rate | uncertain_rate | fp_accept_rate | fn_reject_rate | fp_decided | fn_decided | ok_rate | coverage | accuracy_on_decided | utility | label |
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
| 1.5119 | 0.0000 | 0.6308 | 0.7629 | 0.0000 | 0.2371 | 0.1031 | 0.0000 | 0.1351 | 0.0000 | 0.8969 | 0.7629 | 0.8649 | -0.5052 | grid |
| 1.5119 | 0.0168 | 0.6308 | 0.7629 | 0.0000 | 0.2371 | 0.1031 | 0.0000 | 0.1351 | 0.0000 | 0.8969 | 0.7629 | 0.8649 | -0.5052 | grid |
| 1.5119 | 0.0336 | 0.6308 | 0.7629 | 0.0000 | 0.2371 | 0.1031 | 0.0000 | 0.1351 | 0.0000 | 0.8969 | 0.7629 | 0.8649 | -0.5052 | grid |
| 1.5119 | 0.0503 | 0.6308 | 0.7629 | 0.0000 | 0.2371 | 0.1031 | 0.0000 | 0.1351 | 0.0000 | 0.8969 | 0.7629 | 0.8649 | -0.5052 | grid |
| 1.5119 | 0.0671 | 0.6308 | 0.7629 | 0.0000 | 0.2371 | 0.1031 | 0.0000 | 0.1351 | 0.0000 | 0.8969 | 0.7629 | 0.8649 | -0.5052 | grid |
| 1.5119 | 0.0839 | 0.6308 | 0.7629 | 0.0000 | 0.2371 | 0.1031 | 0.0000 | 0.1351 | 0.0000 | 0.8969 | 0.7629 | 0.8649 | -0.5052 | grid |
| 1.5119 | 0.1007 | 0.6308 | 0.7629 | 0.0000 | 0.2371 | 0.1031 | 0.0000 | 0.1351 | 0.0000 | 0.8969 | 0.7629 | 0.8649 | -0.5052 | grid |
| 1.5119 | 0.1175 | 0.6308 | 0.7629 | 0.0000 | 0.2371 | 0.1031 | 0.0000 | 0.1351 | 0.0000 | 0.8969 | 0.7629 | 0.8649 | -0.5052 | grid |
| 1.5119 | 0.1342 | 0.6308 | 0.7629 | 0.0000 | 0.2371 | 0.1031 | 0.0000 | 0.1351 | 0.0000 | 0.8969 | 0.7629 | 0.8649 | -0.5052 | grid |
| 1.5119 | 0.1510 | 0.6308 | 0.7629 | 0.0000 | 0.2371 | 0.1031 | 0.0000 | 0.1351 | 0.0000 | 0.8969 | 0.7629 | 0.8649 | -0.5052 | grid |
| 1.5119 | 0.1678 | 0.6308 | 0.7629 | 0.0000 | 0.2371 | 0.1031 | 0.0000 | 0.1351 | 0.0000 | 0.8969 | 0.7629 | 0.8649 | -0.5052 | grid |
| 1.5119 | 0.1846 | 0.6308 | 0.7629 | 0.0000 | 0.2371 | 0.1031 | 0.0000 | 0.1351 | 0.0000 | 0.8969 | 0.7629 | 0.8649 | -0.5052 | grid |
| 1.5119 | 0.2014 | 0.6308 | 0.7629 | 0.0000 | 0.2371 | 0.1031 | 0.0000 | 0.1351 | 0.0000 | 0.8969 | 0.7629 | 0.8649 | -0.5052 | grid |
| 1.5119 | 0.2181 | 0.6308 | 0.7629 | 0.0000 | 0.2371 | 0.1031 | 0.0000 | 0.1351 | 0.0000 | 0.8969 | 0.7629 | 0.8649 | -0.5052 | grid |
| 1.5119 | 0.2349 | 0.6308 | 0.7629 | 0.0000 | 0.2371 | 0.1031 | 0.0000 | 0.1351 | 0.0000 | 0.8969 | 0.7629 | 0.8649 | -0.5052 | grid |
| 1.5119 | 0.2517 | 0.6308 | 0.7629 | 0.0000 | 0.2371 | 0.1031 | 0.0000 | 0.1351 | 0.0000 | 0.8969 | 0.7629 | 0.8649 | -0.5052 | grid |
| 1.5119 | 0.2685 | 0.6308 | 0.7629 | 0.0000 | 0.2371 | 0.1031 | 0.0000 | 0.1351 | 0.0000 | 0.8969 | 0.7629 | 0.8649 | -0.5052 | grid |
| 1.5119 | 0.2853 | 0.6308 | 0.7629 | 0.0000 | 0.2371 | 0.1031 | 0.0000 | 0.1351 | 0.0000 | 0.8969 | 0.7629 | 0.8649 | -0.5052 | grid |
| 1.5119 | 0.3020 | 0.6308 | 0.7629 | 0.0000 | 0.2371 | 0.1031 | 0.0000 | 0.1351 | 0.0000 | 0.8969 | 0.7629 | 0.8649 | -0.5052 | grid |
| 1.5119 | 0.3188 | 0.6308 | 0.7629 | 0.0000 | 0.2371 | 0.1031 | 0.0000 | 0.1351 | 0.0000 | 0.8969 | 0.7629 | 0.8649 | -0.5052 | grid |

Pareto summary

| tau | t_lower | t_upper | fp_accept_rate | fn_reject_rate | uncertain_rate | ok_rate | utility |
|---|---|---|---|---|---|---|---|
| 1.1458 | 0.0000 | 0.6812 | 0.0142 | 0.0000 | 0.7255 | 0.9858 | -0.5928 |
| 1.1458 | 0.0168 | 0.6812 | 0.0142 | 0.0000 | 0.7255 | 0.9858 | -0.5928 |
| 1.1458 | 0.0336 | 0.6812 | 0.0142 | 0.0000 | 0.7255 | 0.9858 | -0.5928 |
| 1.1458 | 0.0503 | 0.6812 | 0.0142 | 0.0000 | 0.7255 | 0.9858 | -0.5928 |
| 1.1458 | 0.0671 | 0.6812 | 0.0142 | 0.0000 | 0.7255 | 0.9858 | -0.5928 |
| 1.1458 | 0.0839 | 0.6812 | 0.0142 | 0.0000 | 0.7255 | 0.9858 | -0.5928 |
| 1.1458 | 0.1007 | 0.6812 | 0.0142 | 0.0000 | 0.7255 | 0.9858 | -0.5928 |
| 1.1458 | 0.1175 | 0.6812 | 0.0142 | 0.0000 | 0.7255 | 0.9858 | -0.5928 |
| 1.1458 | 0.1342 | 0.6812 | 0.0142 | 0.0000 | 0.7255 | 0.9858 | -0.5928 |
| 1.1458 | 0.1510 | 0.6812 | 0.0142 | 0.0000 | 0.7255 | 0.9858 | -0.5928 |
| 1.1458 | 0.1678 | 0.6812 | 0.0142 | 0.0000 | 0.7255 | 0.9858 | -0.5928 |
| 1.1458 | 0.1846 | 0.6812 | 0.0142 | 0.0000 | 0.7255 | 0.9858 | -0.5928 |
| 1.1458 | 0.2014 | 0.6812 | 0.0142 | 0.0000 | 0.7255 | 0.9858 | -0.5928 |
| 1.1458 | 0.2181 | 0.6812 | 0.0142 | 0.0000 | 0.7255 | 0.9858 | -0.5928 |
| 1.1458 | 0.2349 | 0.6812 | 0.0142 | 0.0000 | 0.7255 | 0.9858 | -0.5928 |
| 1.1458 | 0.2517 | 0.6812 | 0.0142 | 0.0000 | 0.7255 | 0.9858 | -0.5928 |
| 1.1458 | 0.2685 | 0.6812 | 0.0142 | 0.0000 | 0.7255 | 0.9858 | -0.5928 |
| 1.1458 | 0.2853 | 0.6812 | 0.0142 | 0.0000 | 0.7255 | 0.9858 | -0.5928 |
| 1.1458 | 0.3020 | 0.6812 | 0.0142 | 0.0000 | 0.7255 | 0.9858 | -0.5928 |
| 1.1458 | 0.3188 | 0.6812 | 0.0142 | 0.0000 | 0.7255 | 0.9858 | -0.5928 |

Selected config

- tau: `1.145762711864407`
- t_lower: `0.0`
- t_upper: `0.6811864406779661`
- utility: `-0.5927835051546391`
- fp_accept_rate: `0.014175257731958763`
- fn_reject_rate: `0.0`
- fp_decided_rate: `0.051643192488262914`
- fn_decided_rate: `0.0`
- fp_upper95: `0.025203703984711518`
- fn_upper95: `0.00492612858816457`
- fp_decided_upper95: `0.0900947676881858`
- fn_decided_upper95: `0.017716157785222023`
- constraint_met: `True`

Repro command

```
scripts/stage1_utility_tune.py --track scifact --in_path /mnt/c/Users/nguye/Downloads/My projject/the-rag-auditor/data/calibration/scifact_stage1_dev_train.parquet --logit_col raw_max_top3 --y_col y --n 1000 --seed 14 --tau_source joint_grid --tau_grid_steps 60 --threshold_steps 60 --constraint_ci wilson --out_md reports/stage1_utility_tuning_scifact.md --out_yaml configs/thresholds_stage1_product_scifact.yaml --progress
```
