# Stage1 Large-N Eval (scifact)

- in_path: `/mnt/c/Users/nguye/Downloads/My projject/the-rag-auditor/data/calibration/scifact_stage1_dev_train.parquet`
- n_total: 776
- seed: 14
- logit_col: `raw_max_top3`
- y_col: `y`

## Baseline config
- thresholds_yaml: `configs/thresholds.yaml`
- t_lower: 0.7792245061204353
- t_upper: 0.8008901176300922
- tau: 0.609483051351548

| metric | value | 95% CI |
|---|---:|---:|
| accept_rate | 0.4536 | [0.4188, 0.4871] |
| reject_rate | 0.0619 | [0.0464, 0.0799] |
| uncertain_rate | 0.4845 | [0.4510, 0.5193] |
| fp_accept_rate | 0.0425 | [0.0296, 0.0567] |
| fn_reject_rate | 0.0322 | [0.0206, 0.0464] |
| risk | 0.0747 | |
| coverage | 0.5155 | [0.4807, 0.5490] |
| ok_rate | 0.9253 | [0.9053, 0.9427] |
| precision_accept | 0.9062 | |

## Tuned config
- tuned_thresholds_yaml: `configs/thresholds_stage1_tuned_scifact.yaml`
- t_lower: 0.7788163428551291
- t_upper: 0.8012982808953983
- tau: 0.609483051351548

| metric | value | 95% CI |
|---|---:|---:|
| accept_rate | 0.4381 | [0.4021, 0.4742] |
| reject_rate | 0.0619 | [0.0464, 0.0799] |
| uncertain_rate | 0.5000 | [0.4607, 0.5374] |
| fp_accept_rate | 0.0399 | [0.0258, 0.0528] |
| fn_reject_rate | 0.0322 | [0.0212, 0.0451] |
| risk | 0.0722 | |
| coverage | 0.5000 | [0.4626, 0.5393] |
| ok_rate | 0.9278 | [0.9098, 0.9453] |
| precision_accept | 0.9088 | |

## McNemar exact test
- b (A correct, B wrong): 0
- c (A wrong, B correct): 2
- p_value: 0.500000

## Bootstrap delta CI (tuned - baseline)
| metric | 95% CI |
|---|---:|
| ok_rate | [0.0000, 0.0064] |
| fp_accept_rate | [-0.0064, 0.0000] |
| fn_reject_rate | [0.0000, 0.0000] |
| uncertain_rate | [0.0064, 0.0252] |

## Risk-coverage sweep
### Top coverage under risk <= 0.02
| t_lower | t_upper | risk | coverage |
|---:|---:|---:|---:|
| 0.0000 | 0.8350 | 0.0000 | 0.0000 |
| 0.0000 | 0.8763 | 0.0000 | 0.0000 |
| 0.0000 | 0.9175 | 0.0000 | 0.0000 |
| 0.0000 | 0.9588 | 0.0000 | 0.0000 |
| 0.0000 | 1.0000 | 0.0000 | 0.0000 |
| 0.0413 | 0.8350 | 0.0000 | 0.0000 |
| 0.0413 | 0.8763 | 0.0000 | 0.0000 |
| 0.0413 | 0.9175 | 0.0000 | 0.0000 |
| 0.0413 | 0.9588 | 0.0000 | 0.0000 |
| 0.0413 | 1.0000 | 0.0000 | 0.0000 |
| 0.0825 | 0.8350 | 0.0000 | 0.0000 |
| 0.0825 | 0.8763 | 0.0000 | 0.0000 |
| 0.0825 | 0.9175 | 0.0000 | 0.0000 |
| 0.0825 | 0.9588 | 0.0000 | 0.0000 |
| 0.0825 | 1.0000 | 0.0000 | 0.0000 |
| 0.1237 | 0.8350 | 0.0000 | 0.0000 |
| 0.1237 | 0.8763 | 0.0000 | 0.0000 |
| 0.1237 | 0.9175 | 0.0000 | 0.0000 |
| 0.1237 | 0.9588 | 0.0000 | 0.0000 |
| 0.1237 | 1.0000 | 0.0000 | 0.0000 |

### Top coverage under risk <= 0.05
| t_lower | t_upper | risk | coverage |
|---:|---:|---:|---:|
| 0.0000 | 0.8350 | 0.0000 | 0.0000 |
| 0.0000 | 0.8763 | 0.0000 | 0.0000 |
| 0.0000 | 0.9175 | 0.0000 | 0.0000 |
| 0.0000 | 0.9588 | 0.0000 | 0.0000 |
| 0.0000 | 1.0000 | 0.0000 | 0.0000 |
| 0.0413 | 0.8350 | 0.0000 | 0.0000 |
| 0.0413 | 0.8763 | 0.0000 | 0.0000 |
| 0.0413 | 0.9175 | 0.0000 | 0.0000 |
| 0.0413 | 0.9588 | 0.0000 | 0.0000 |
| 0.0413 | 1.0000 | 0.0000 | 0.0000 |
| 0.0825 | 0.8350 | 0.0000 | 0.0000 |
| 0.0825 | 0.8763 | 0.0000 | 0.0000 |
| 0.0825 | 0.9175 | 0.0000 | 0.0000 |
| 0.0825 | 0.9588 | 0.0000 | 0.0000 |
| 0.0825 | 1.0000 | 0.0000 | 0.0000 |
| 0.1237 | 0.8350 | 0.0000 | 0.0000 |
| 0.1237 | 0.8763 | 0.0000 | 0.0000 |
| 0.1237 | 0.9175 | 0.0000 | 0.0000 |
| 0.1237 | 0.9588 | 0.0000 | 0.0000 |
| 0.1237 | 1.0000 | 0.0000 | 0.0000 |

### Top coverage under risk <= 0.1
| t_lower | t_upper | risk | coverage |
|---:|---:|---:|---:|
| 0.0000 | 0.7938 | 0.0902 | 0.6765 |
| 0.0413 | 0.7938 | 0.0902 | 0.6765 |
| 0.0825 | 0.7938 | 0.0902 | 0.6765 |
| 0.1237 | 0.7938 | 0.0902 | 0.6765 |
| 0.1650 | 0.7938 | 0.0902 | 0.6765 |
| 0.2063 | 0.7938 | 0.0902 | 0.6765 |
| 0.2475 | 0.7938 | 0.0902 | 0.6765 |
| 0.2888 | 0.7938 | 0.0902 | 0.6765 |
| 0.3300 | 0.7938 | 0.0902 | 0.6765 |
| 0.3713 | 0.7938 | 0.0902 | 0.6765 |
| 0.4125 | 0.7938 | 0.0902 | 0.6765 |
| 0.4538 | 0.7938 | 0.0902 | 0.6765 |
| 0.4950 | 0.7938 | 0.0902 | 0.6765 |
| 0.5363 | 0.7938 | 0.0902 | 0.6765 |
| 0.5775 | 0.7938 | 0.0902 | 0.6765 |
| 0.6188 | 0.7938 | 0.0902 | 0.6765 |
| 0.6600 | 0.7938 | 0.0902 | 0.6765 |
| 0.7013 | 0.7938 | 0.0902 | 0.6765 |
| 0.7425 | 0.7938 | 0.0902 | 0.6765 |
| 0.7838 | 0.8350 | 0.0657 | 0.1173 |


## Repro command
```
scripts/eval_stage1_large_n.py --track scifact --in_path /mnt/c/Users/nguye/Downloads/My projject/the-rag-auditor/data/calibration/scifact_stage1_dev_train.parquet --logit_col raw_max_top3 --y_col y --tuned_thresholds_yaml configs/thresholds_stage1_tuned_scifact.yaml --n 1000 --out_md reports/stage1_eval_scifact_large.md
```
